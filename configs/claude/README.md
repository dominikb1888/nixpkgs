# Claude Code Configuration

This directory contains my [Claude Code](https://claude.ai/code) configuration files.

## How It Works

These files are symlinked into `~/.claude/` by [Home Manager](https://github.com/nix-community/home-manager) using `mkOutOfStoreSymlink`. This means:

- Files can be edited in place without rebuilding the Nix configuration
- Changes take effect immediately (or on next Claude Code session)
- Everything stays version-controlled in this repo

The symlinks are set up in [`home/claude.nix`](../../home/claude.nix).

## Directory Structure

| Path          | Description                                           |
| ------------- | ----------------------------------------------------- |
| `CLAUDE.md`   | Global instructions loaded in every session           |
| `settings.json` | Permissions, hooks, plugins (symlinked, live-editable) |
| `1mcp.json`   | MCP server definitions for 1MCP aggregator            |
| `commands/`   | Custom slash commands                                 |
| `agents/`     | Custom agent definitions                              |
| `skills/`     | Custom skills                                         |
| `rules/`      | Custom rules                                          |
| `hooks/`      | Global hooks (PostToolUse, etc.)                      |
| `plugins/`    | Personal plugin marketplace (see `plugins/README.md`) |

## What's NOT Here

**`mcp.json`** is generated by Nix (just points CLI to 1MCP). **`settings.json`** is symlinked from here for live editing.

## The Home Manager Module

The [`home/claude.nix`](../../home/claude.nix) module:

1. Adds shell alias with `--mcp-config` pointing to the generated `mcp.json`
2. Runs 1MCP as a LaunchAgent to aggregate all MCP servers
3. Generates `mcp.json` (CLI) and Desktop config (both point to 1MCP on localhost:3050)
4. Symlinks everything else from this directory into `~/.claude/`

## MCP Architecture

MCP servers are aggregated via [1MCP](https://docs.1mcp.app):

- **Server definitions:** `1mcp.json` in this directory (symlinked to `~/.config/1mcp/mcp.json`)
- **Secrets:** 1Password Environment at `~/.claude/secrets.env` (uses `${VAR}` interpolation)
- **LaunchAgent:** Starts 1MCP on boot when secrets are available
